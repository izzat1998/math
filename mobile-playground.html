<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Math Exam — Mobile UI Playground</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

  :root {
    --primary: #1e3a5f;
    --accent: #0ea5e9;
    --success: #22c55e;
    --warning: #f59e0b;
    --danger: #ef4444;
    --bg: #f8fafc;
    --surface: #ffffff;
    --text: #0f172a;
    --text-secondary: #64748b;
    --border: #e2e8f0;
    --panel-bg: #111318;
    --panel-surface: #1a1d24;
    --panel-border: #2a2d35;
    --panel-text: #e2e8f0;
    --panel-text-secondary: #94a3b8;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Inter', system-ui, -apple-system, sans-serif;
    background: var(--panel-bg);
    color: var(--panel-text);
    height: 100vh;
    overflow: hidden;
    display: flex;
  }

  /* ── Controls Panel ── */
  .controls {
    width: 300px;
    min-width: 300px;
    background: var(--panel-surface);
    border-right: 1px solid var(--panel-border);
    overflow-y: auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .controls h1 {
    font-size: 16px;
    font-weight: 700;
    color: var(--panel-text);
    margin-bottom: 4px;
    letter-spacing: -0.3px;
  }

  .controls h1 span { color: var(--accent); }

  .control-group {
    background: var(--panel-bg);
    border: 1px solid var(--panel-border);
    border-radius: 10px;
    padding: 14px;
  }

  .control-group label {
    display: block;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--panel-text-secondary);
    margin-bottom: 10px;
  }

  .device-buttons, .screen-buttons, .preset-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }

  .device-buttons button, .screen-buttons button, .preset-buttons button {
    flex: 1;
    min-width: 0;
    padding: 8px 6px;
    border: 1px solid var(--panel-border);
    border-radius: 8px;
    background: var(--panel-surface);
    color: var(--panel-text);
    font-size: 11px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.15s;
    font-family: inherit;
    white-space: nowrap;
  }

  .device-buttons button:hover, .screen-buttons button:hover, .preset-buttons button:hover {
    border-color: var(--accent);
    color: var(--accent);
  }

  .device-buttons button.active, .screen-buttons button.active, .preset-buttons button.active {
    background: var(--accent);
    border-color: var(--accent);
    color: #fff;
  }

  .toggle-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 4px 0;
  }

  .toggle-row span {
    font-size: 13px;
    color: var(--panel-text);
  }

  .toggle {
    position: relative;
    width: 44px;
    height: 24px;
    cursor: pointer;
  }

  .toggle input { opacity: 0; width: 0; height: 0; }

  .toggle .slider {
    position: absolute;
    inset: 0;
    background: var(--panel-border);
    border-radius: 12px;
    transition: 0.2s;
  }

  .toggle .slider::before {
    content: '';
    position: absolute;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: #fff;
    left: 3px;
    top: 3px;
    transition: 0.2s;
  }

  .toggle input:checked + .slider {
    background: var(--accent);
  }

  .toggle input:checked + .slider::before {
    transform: translateX(20px);
  }

  /* ── Preview Area ── */
  .preview-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 24px;
    overflow: hidden;
    position: relative;
  }

  .device-frame {
    position: relative;
    background: #000;
    border-radius: 40px;
    padding: 12px;
    box-shadow: 0 0 0 2px #333, 0 20px 60px rgba(0,0,0,0.5);
    transition: width 0.3s, height 0.3s;
    overflow: hidden;
  }

  .device-screen {
    width: 100%;
    height: 100%;
    border-radius: 28px;
    overflow: hidden;
    position: relative;
    background: var(--bg);
  }

  .notch {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 120px;
    height: 28px;
    background: #000;
    border-radius: 0 0 18px 18px;
    z-index: 100;
  }

  .dynamic-island {
    position: absolute;
    top: 8px;
    left: 50%;
    transform: translateX(-50%);
    width: 90px;
    height: 24px;
    background: #000;
    border-radius: 14px;
    z-index: 100;
  }

  .status-bar {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 24px;
    z-index: 99;
    font-size: 12px;
    font-weight: 600;
    color: var(--text);
  }

  .status-bar .time { font-size: 14px; font-weight: 700; }
  .status-bar .icons { display: flex; gap: 4px; align-items: center; font-size: 11px; }

  /* ── App Screens ── */
  .app-container {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    overflow: hidden;
  }

  .screen {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    flex-direction: column;
    transition: transform 0.3s ease, opacity 0.3s ease;
    background: var(--bg);
    will-change: transform;
  }

  .screen.hidden-left {
    transform: translateX(-100%);
    opacity: 0;
    pointer-events: none;
  }

  .screen.hidden-right {
    transform: translateX(100%);
    opacity: 0;
    pointer-events: none;
  }

  .screen.visible {
    transform: translateX(0);
    opacity: 1;
  }

  /* ── Login Screen ── */
  .login-screen {
    justify-content: center;
    align-items: center;
    padding: 32px 24px;
    background: var(--bg);
  }

  .login-logo {
    width: 56px;
    height: 56px;
    background: var(--primary);
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 12px;
  }

  .login-logo svg { width: 30px; height: 30px; }

  .login-title {
    font-size: 22px;
    font-weight: 800;
    color: var(--primary);
    margin-bottom: 4px;
    letter-spacing: -0.5px;
  }

  .login-subtitle {
    font-size: 13px;
    color: var(--text-secondary);
    margin-bottom: 28px;
  }

  .login-form {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .login-input {
    width: 100%;
    height: 52px;
    padding: 0 16px;
    border: 1.5px solid var(--border);
    border-radius: 14px;
    background: #fff;
    font-size: 16px;
    font-family: inherit;
    color: var(--text);
    outline: none;
    transition: border-color 0.15s;
  }

  .login-input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(14,165,233,0.1);
  }

  .login-input::placeholder {
    color: #94a3b8;
  }

  .login-btn {
    width: 100%;
    height: 52px;
    border: none;
    border-radius: 14px;
    background: var(--primary);
    color: #fff;
    font-size: 16px;
    font-weight: 700;
    font-family: inherit;
    cursor: pointer;
    margin-top: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: background 0.15s;
  }

  .login-btn:hover { background: #162d4a; }

  .login-btn svg { width: 18px; height: 18px; }

  /* ── Exam Screen ── */
  .exam-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 50px 16px 8px;
    background: #fff;
    border-bottom: 1px solid var(--border);
    min-height: 40px;
    z-index: 10;
  }

  .exam-header.telegram-header {
    padding-top: 8px;
    min-height: 0;
    border-bottom: none;
    background: transparent;
  }

  .exam-back {
    width: 36px;
    height: 36px;
    border-radius: 10px;
    border: none;
    background: var(--bg);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: var(--primary);
  }

  .exam-title {
    font-size: 15px;
    font-weight: 700;
    color: var(--primary);
    flex: 1;
    text-align: center;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    padding: 0 8px;
  }

  .exam-timer {
    font-size: 14px;
    font-weight: 700;
    font-variant-numeric: tabular-nums;
    color: var(--primary);
    background: rgba(14,165,233,0.08);
    padding: 6px 10px;
    border-radius: 10px;
    white-space: nowrap;
  }

  .exam-timer.urgent {
    color: var(--danger);
    background: rgba(239,68,68,0.08);
    animation: pulse-timer 1s infinite;
  }

  @keyframes pulse-timer {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
  }

  .pdf-area {
    flex: 1;
    background: #e9ecef;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: hidden;
    min-height: 0;
  }

  .pdf-placeholder {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    color: #94a3b8;
  }

  .pdf-placeholder svg { width: 48px; height: 48px; opacity: 0.5; }
  .pdf-placeholder span { font-size: 12px; font-weight: 500; }

  .pdf-zoom-hint {
    position: absolute;
    bottom: 12px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 11px;
    color: #94a3b8;
    background: rgba(255,255,255,0.85);
    padding: 4px 12px;
    border-radius: 20px;
    backdrop-filter: blur(6px);
  }

  /* ── Answer Bar ── */
  .answer-bar {
    background: #fff;
    border-top: 1px solid var(--border);
    padding: 10px 16px;
    padding-bottom: calc(10px + env(safe-area-inset-bottom, 0px));
    z-index: 20;
  }

  .answer-bar.telegram-mode {
    padding-bottom: 10px;
  }

  .question-nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 10px;
  }

  .q-nav-btn {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    border: 1.5px solid var(--border);
    background: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: var(--text-secondary);
    transition: all 0.15s;
  }

  .q-nav-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
  }

  .q-nav-btn:disabled {
    opacity: 0.3;
    cursor: default;
  }

  .q-label {
    font-size: 14px;
    font-weight: 700;
    color: var(--primary);
  }

  .answer-options {
    display: flex;
    gap: 8px;
    margin-bottom: 10px;
    touch-action: pan-y;
    user-select: none;
  }

  .answer-pill {
    flex: 1;
    height: 48px;
    border: 2px solid var(--border);
    border-radius: 14px;
    background: #fff;
    font-size: 17px;
    font-weight: 700;
    font-family: inherit;
    color: var(--text);
    cursor: pointer;
    transition: all 0.15s;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .answer-pill:hover {
    border-color: var(--accent);
    background: rgba(14,165,233,0.04);
  }

  .answer-pill.selected {
    background: var(--accent);
    border-color: var(--accent);
    color: #fff;
    transform: scale(0.96);
    box-shadow: 0 2px 8px rgba(14,165,233,0.25);
  }

  /* Free text answer */
  .answer-text-input {
    width: 100%;
    height: 48px;
    padding: 0 14px;
    border: 2px solid var(--border);
    border-radius: 14px;
    background: #fff;
    font-size: 16px;
    font-family: inherit;
    color: var(--text);
    outline: none;
    margin-bottom: 10px;
    transition: border-color 0.15s;
  }

  .answer-text-input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(14,165,233,0.1);
  }

  .progress-dots {
    display: flex;
    justify-content: center;
    gap: 4px;
    flex-wrap: wrap;
    max-height: 20px;
    overflow: hidden;
  }

  .dot {
    width: 7px;
    height: 7px;
    border-radius: 50%;
    background: var(--border);
    cursor: pointer;
    transition: all 0.15s;
    flex-shrink: 0;
  }

  .dot.answered { background: var(--accent); }

  .dot.current {
    background: var(--primary);
    transform: scale(1.4);
  }

  .dot:hover { transform: scale(1.5); }

  /* ── Telegram MainButton ── */
  .tg-main-button {
    width: 100%;
    height: 50px;
    background: var(--accent);
    color: #fff;
    border: none;
    font-size: 16px;
    font-weight: 700;
    font-family: inherit;
    cursor: pointer;
    display: none;
    align-items: center;
    justify-content: center;
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 50;
  }

  .tg-main-button.visible { display: flex; }

  .tg-back-button {
    position: absolute;
    top: 44px;
    left: 8px;
    background: none;
    border: none;
    color: var(--accent);
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    z-index: 100;
    display: none;
    align-items: center;
    gap: 4px;
    font-family: inherit;
    padding: 6px 8px;
  }

  .tg-back-button.visible { display: flex; }

  /* ── Results Screen ── */
  .results-screen {
    padding: 50px 20px 20px;
    overflow-y: auto;
    align-items: center;
  }

  .results-header {
    display: flex;
    align-items: center;
    width: 100%;
    margin-bottom: 24px;
  }

  .results-back {
    width: 36px;
    height: 36px;
    border-radius: 10px;
    border: none;
    background: var(--bg);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: var(--primary);
  }

  .results-title {
    font-size: 17px;
    font-weight: 700;
    color: var(--primary);
    flex: 1;
    text-align: center;
    padding-right: 36px;
  }

  .score-circle {
    position: relative;
    width: 140px;
    height: 140px;
    margin-bottom: 8px;
  }

  .score-circle svg {
    width: 140px;
    height: 140px;
    transform: rotate(-90deg);
  }

  .score-circle .bg-ring {
    fill: none;
    stroke: var(--border);
    stroke-width: 8;
  }

  .score-circle .fg-ring {
    fill: none;
    stroke: var(--accent);
    stroke-width: 8;
    stroke-linecap: round;
    transition: stroke-dashoffset 0.8s ease;
  }

  .score-value {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
  }

  .score-value .big {
    font-size: 32px;
    font-weight: 800;
    color: var(--primary);
    line-height: 1;
    letter-spacing: -1px;
  }

  .score-value .pct {
    font-size: 14px;
    font-weight: 600;
    color: var(--accent);
  }

  .score-label {
    font-size: 13px;
    color: var(--text-secondary);
    margin-bottom: 20px;
  }

  .results-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 6px;
    width: 100%;
    max-width: 280px;
    margin-bottom: 20px;
  }

  .result-cell {
    aspect-ratio: 1;
    border-radius: 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 700;
    cursor: pointer;
    transition: transform 0.15s;
    gap: 1px;
  }

  .result-cell:hover { transform: scale(1.08); }

  .result-cell.correct {
    background: rgba(34,197,94,0.12);
    color: var(--success);
  }

  .result-cell.wrong {
    background: rgba(239,68,68,0.1);
    color: var(--danger);
  }

  .result-cell.unanswered {
    background: rgba(100,116,139,0.08);
    color: var(--text-secondary);
  }

  .result-cell .icon { font-size: 14px; }

  .share-btn {
    width: 100%;
    max-width: 280px;
    height: 48px;
    border: none;
    border-radius: 14px;
    background: var(--primary);
    color: #fff;
    font-size: 15px;
    font-weight: 700;
    font-family: inherit;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: background 0.15s;
  }

  .share-btn:hover { background: #162d4a; }

  /* ── Prompt Area ── */
  .prompt-area {
    position: fixed;
    bottom: 0;
    left: 300px;
    right: 0;
    background: var(--panel-surface);
    border-top: 1px solid var(--panel-border);
    padding: 16px 24px;
    z-index: 200;
  }

  .prompt-label {
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--panel-text-secondary);
    margin-bottom: 8px;
  }

  .prompt-box {
    display: flex;
    align-items: flex-start;
    gap: 12px;
  }

  .prompt-text {
    flex: 1;
    font-size: 13px;
    line-height: 1.5;
    color: var(--panel-text);
    font-family: 'SF Mono', 'Fira Code', monospace;
    max-height: 80px;
    overflow-y: auto;
  }

  .copy-btn {
    padding: 8px 16px;
    border-radius: 8px;
    border: 1px solid var(--panel-border);
    background: var(--panel-bg);
    color: var(--panel-text);
    font-size: 12px;
    font-weight: 600;
    font-family: inherit;
    cursor: pointer;
    white-space: nowrap;
    transition: all 0.15s;
    flex-shrink: 0;
  }

  .copy-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
  }

  .copy-btn.copied {
    background: var(--accent);
    border-color: var(--accent);
    color: #fff;
  }

  /* Math keyboard hint */
  .math-kb-hint {
    font-size: 10px;
    color: var(--text-secondary);
    text-align: center;
    margin-top: -4px;
    margin-bottom: 6px;
  }

  /* Swipe indicator */
  .swipe-hint {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    font-size: 10px;
    color: var(--text-secondary);
    margin-top: 6px;
    opacity: 0.7;
  }

  .swipe-hint svg { width: 14px; height: 14px; }

  /* Telegram header bar */
  .tg-header-bar {
    height: 44px;
    background: var(--primary);
    display: none;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-size: 15px;
    font-weight: 600;
    position: relative;
    z-index: 50;
  }

  .tg-header-bar.visible { display: flex; }

  .tg-header-bar .tg-hb-back {
    position: absolute;
    left: 12px;
    background: none;
    border: none;
    color: #fff;
    font-size: 14px;
    cursor: pointer;
    font-family: inherit;
    display: flex;
    align-items: center;
    gap: 4px;
  }
</style>
</head>
<body>

<!-- ══════ Controls Panel ══════ -->
<div class="controls">
  <h1><span>Math Exam</span> — Mobile UI</h1>

  <div class="control-group">
    <label>Device</label>
    <div class="device-buttons">
      <button onclick="setDevice('se')" id="dev-se">iPhone SE</button>
      <button onclick="setDevice('14')" id="dev-14" class="active">iPhone 14</button>
      <button onclick="setDevice('14pm')" id="dev-14pm">14 Pro Max</button>
    </div>
  </div>

  <div class="control-group">
    <label>Screen</label>
    <div class="screen-buttons">
      <button onclick="setScreen('login')" id="scr-login">Login</button>
      <button onclick="setScreen('exam')" id="scr-exam" class="active">Exam</button>
      <button onclick="setScreen('results')" id="scr-results">Results</button>
    </div>
  </div>

  <div class="control-group">
    <label>Mode</label>
    <div class="toggle-row">
      <span>Telegram Mini App</span>
      <label class="toggle">
        <input type="checkbox" id="tg-toggle" onchange="toggleTelegram()">
        <span class="slider"></span>
      </label>
    </div>
    <div class="toggle-row" style="margin-top:8px">
      <span>Timer Urgent</span>
      <label class="toggle">
        <input type="checkbox" id="urgent-toggle" onchange="toggleUrgent()">
        <span class="slider"></span>
      </label>
    </div>
    <div class="toggle-row" style="margin-top:8px">
      <span>Free-text Question</span>
      <label class="toggle">
        <input type="checkbox" id="freetext-toggle" onchange="toggleFreetext()">
        <span class="slider"></span>
      </label>
    </div>
  </div>

  <div class="control-group">
    <label>Presets</label>
    <div class="preset-buttons">
      <button onclick="applyPreset('default')">Default</button>
      <button onclick="applyPreset('tg-exam')">TG Exam</button>
      <button onclick="applyPreset('tg-results')">TG Results</button>
      <button onclick="applyPreset('urgent')">Urgent Timer</button>
    </div>
  </div>

  <div class="control-group" style="flex:1; display:flex; flex-direction:column;">
    <label>How it works</label>
    <div style="font-size:12px; color:var(--panel-text-secondary); line-height:1.6;">
      <p><strong>Swipe</strong> left/right on the answer bar to navigate questions.</p>
      <p style="margin-top:6px"><strong>Tap</strong> A/B/C/D pills to select answers.</p>
      <p style="margin-top:6px"><strong>Tap progress dots</strong> to jump to a question.</p>
      <p style="margin-top:6px"><strong>Telegram mode</strong> replaces the custom header with native Telegram controls.</p>
    </div>
  </div>
</div>

<!-- ══════ Preview Area ══════ -->
<div class="preview-area" id="preview-area">
  <div class="device-frame" id="device-frame">
    <div class="device-screen" id="device-screen">

      <!-- Status bar -->
      <div class="status-bar" id="status-bar">
        <span class="time">9:41</span>
        <span class="icons">
          <svg width="16" height="12" viewBox="0 0 16 12" fill="currentColor"><rect x="0" y="6" width="3" height="6" rx="1"/><rect x="4.5" y="4" width="3" height="8" rx="1"/><rect x="9" y="2" width="3" height="10" rx="1"/><rect x="13.5" y="0" width="3" height="12" rx="1" opacity="0.3"/></svg>
          <svg width="20" height="12" viewBox="0 0 20 12" fill="currentColor"><rect x="0" y="0" width="18" height="12" rx="2" fill="none" stroke="currentColor" stroke-width="1.5"/><rect x="2" y="2.5" width="12" height="7" rx="1"/><rect x="18.5" y="3.5" width="2" height="5" rx="1"/></svg>
        </span>
      </div>

      <!-- Telegram header -->
      <div class="tg-header-bar" id="tg-header-bar">
        <button class="tg-hb-back" onclick="goBack()">
          <svg width="10" height="16" viewBox="0 0 10 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><polyline points="8,2 2,8 8,14"/></svg>
          Back
        </button>
        <span id="tg-header-title">Math Exam</span>
      </div>

      <!-- Notch -->
      <div id="notch" class="notch"></div>

      <div class="app-container" id="app-container">

        <!-- ── Login Screen ── -->
        <div class="screen login-screen hidden-left" id="login-screen">
          <div class="login-logo">
            <svg viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round">
              <path d="M4 4h6v6H4zM14 4h6v6h-6zM4 14h6v6H4z"/>
              <circle cx="17" cy="17" r="3"/>
            </svg>
          </div>
          <div class="login-title">Math Exam</div>
          <div class="login-subtitle">Imtihonga kirish</div>
          <div class="login-form">
            <input class="login-input" type="text" placeholder="Ism va familiya" readonly>
            <input class="login-input" type="text" placeholder="Kod kiriting (XXXX-XXXX)" readonly style="letter-spacing:1px">
            <button class="login-btn">
              Kirish
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
            </button>
          </div>
        </div>

        <!-- ── Exam Screen ── -->
        <div class="screen visible" id="exam-screen">
          <div class="exam-header" id="exam-header">
            <button class="exam-back" onclick="goBack()">
              <svg width="10" height="16" viewBox="0 0 10 16" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round"><polyline points="8,2 2,8 8,14"/></svg>
            </button>
            <span class="exam-title">Matematika — Mock #3</span>
            <span class="exam-timer" id="exam-timer">01:23:45</span>
          </div>

          <div class="pdf-area" id="pdf-area">
            <div class="pdf-placeholder">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                <polyline points="14 2 14 8 20 8"/>
                <line x1="8" y1="13" x2="16" y2="13"/>
                <line x1="8" y1="17" x2="14" y2="17"/>
              </svg>
              <span>PDF — Pinch to zoom</span>
            </div>
            <div class="pdf-zoom-hint">Double-tap to fit width</div>
          </div>

          <div class="answer-bar" id="answer-bar">
            <div class="question-nav">
              <button class="q-nav-btn" id="q-prev" onclick="prevQuestion()">
                <svg width="8" height="14" viewBox="0 0 8 14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><polyline points="7,1 1,7 7,13"/></svg>
              </button>
              <span class="q-label" id="q-label">Savol 1 / 45</span>
              <button class="q-nav-btn" id="q-next" onclick="nextQuestion()">
                <svg width="8" height="14" viewBox="0 0 8 14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><polyline points="1,1 7,7 1,13"/></svg>
              </button>
            </div>

            <div class="answer-options" id="answer-options">
              <button class="answer-pill" data-opt="A" onclick="selectAnswer('A')">A</button>
              <button class="answer-pill" data-opt="B" onclick="selectAnswer('B')">B</button>
              <button class="answer-pill" data-opt="C" onclick="selectAnswer('C')">C</button>
              <button class="answer-pill" data-opt="D" onclick="selectAnswer('D')">D</button>
            </div>

            <div id="answer-text-container" style="display:none">
              <input class="answer-text-input" type="text" placeholder="Javobni kiriting..." id="answer-text" readonly>
              <div class="math-kb-hint">Math keyboard: sqrt, pi, sin, cos...</div>
            </div>

            <div class="progress-dots" id="progress-dots"></div>

            <div class="swipe-hint" id="swipe-hint">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
              Swipe to navigate
            </div>
          </div>

          <!-- Telegram MainButton -->
          <button class="tg-main-button" id="tg-main-button">Topshirish</button>
        </div>

        <!-- ── Results Screen ── -->
        <div class="screen results-screen hidden-right" id="results-screen">
          <div class="results-header" id="results-header">
            <button class="results-back" onclick="goBack()">
              <svg width="10" height="16" viewBox="0 0 10 16" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round"><polyline points="8,2 2,8 8,14"/></svg>
            </button>
            <span class="results-title">Natijalar</span>
          </div>

          <div class="score-circle">
            <svg viewBox="0 0 140 140">
              <circle class="bg-ring" cx="70" cy="70" r="58"/>
              <circle class="fg-ring" id="score-ring" cx="70" cy="70" r="58"
                stroke-dasharray="364.4"
                stroke-dashoffset="102"/>
            </svg>
            <div class="score-value">
              <div class="big">32/45</div>
              <div class="pct">71%</div>
            </div>
          </div>
          <div class="score-label">Yaxshi natija!</div>

          <div class="results-grid" id="results-grid"></div>

          <button class="share-btn" id="share-btn">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
            Natijani ulashish
          </button>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- ══════ Prompt Output ══════ -->
<div class="prompt-area" id="prompt-area">
  <div class="prompt-label">Prompt Output</div>
  <div class="prompt-box">
    <div class="prompt-text" id="prompt-text"></div>
    <button class="copy-btn" id="copy-btn" onclick="copyPrompt()">Copy</button>
  </div>
</div>

<script>
// ══════ State ══════
const state = {
  device: '14',
  screen: 'exam',
  telegram: false,
  urgent: false,
  freetext: false,
  currentQuestion: 1,
  totalQuestions: 45,
  answers: {},
  // Device specs: [width, height, notchType]
  devices: {
    se:   { w: 320, h: 568, notch: 'none', label: 'iPhone SE' },
    '14': { w: 390, h: 844, notch: 'notch', label: 'iPhone 14' },
    '14pm': { w: 430, h: 932, notch: 'island', label: '14 Pro Max' },
  }
};

// Pre-populate some answers
[1,2,3,5,7,8,10,12,15,18,20,22,25,28,30,31,33,35,38,40,42].forEach(q => {
  state.answers[q] = ['A','B','C','D'][Math.floor(Math.random()*4)];
});

// ══════ DOM refs ══════
const frame = document.getElementById('device-frame');
const screen_ = document.getElementById('device-screen');
const notchEl = document.getElementById('notch');
const statusBar = document.getElementById('status-bar');
const tgHeaderBar = document.getElementById('tg-header-bar');
const tgHeaderTitle = document.getElementById('tg-header-title');
const examHeader = document.getElementById('exam-header');
const examTimer = document.getElementById('exam-timer');
const answerBar = document.getElementById('answer-bar');
const answerOptions = document.getElementById('answer-options');
const answerTextContainer = document.getElementById('answer-text-container');
const qLabel = document.getElementById('q-label');
const qPrev = document.getElementById('q-prev');
const qNext = document.getElementById('q-next');
const dots = document.getElementById('progress-dots');
const tgMainBtn = document.getElementById('tg-main-button');
const promptText = document.getElementById('prompt-text');
const resultsHeader = document.getElementById('results-header');
const shareBtnEl = document.getElementById('share-btn');

// ══════ Device ══════
function setDevice(d) {
  state.device = d;
  document.querySelectorAll('.device-buttons button').forEach(b => b.classList.remove('active'));
  document.getElementById('dev-' + d).classList.add('active');
  updateAll();
}

// ══════ Screen ══════
function setScreen(s) {
  const prev = state.screen;
  state.screen = s;
  document.querySelectorAll('.screen-buttons button').forEach(b => b.classList.remove('active'));
  document.getElementById('scr-' + s).classList.add('active');

  const screenOrder = ['login', 'exam', 'results'];
  const prevIdx = screenOrder.indexOf(prev);
  const newIdx = screenOrder.indexOf(s);
  const direction = newIdx > prevIdx ? 1 : -1;

  // Animate screens
  ['login', 'exam', 'results'].forEach(sc => {
    const el = document.getElementById(sc + '-screen');
    const scIdx = screenOrder.indexOf(sc);
    if (sc === s) {
      el.className = 'screen visible';
      if (sc === 'results') el.className += ' results-screen';
      if (sc === 'login') el.className += ' login-screen';
    } else if (scIdx < newIdx) {
      el.className = 'screen hidden-left';
      if (sc === 'login') el.className += ' login-screen';
    } else {
      el.className = 'screen hidden-right';
      if (sc === 'results') el.className += ' results-screen';
    }
  });

  updateAll();
}

// ══════ Toggles ══════
function toggleTelegram() {
  state.telegram = document.getElementById('tg-toggle').checked;
  updateAll();
}

function toggleUrgent() {
  state.urgent = document.getElementById('urgent-toggle').checked;
  updateAll();
}

function toggleFreetext() {
  state.freetext = document.getElementById('freetext-toggle').checked;
  updateAll();
}

// ══════ Presets ══════
function applyPreset(p) {
  const presets = {
    'default': { device: '14', screen: 'exam', telegram: false, urgent: false, freetext: false },
    'tg-exam': { device: '14', screen: 'exam', telegram: true, urgent: false, freetext: false },
    'tg-results': { device: '14pm', screen: 'results', telegram: true, urgent: false, freetext: false },
    'urgent': { device: 'se', screen: 'exam', telegram: false, urgent: true, freetext: false },
  };
  const pr = presets[p];
  state.device = pr.device;
  state.screen = pr.screen;
  state.telegram = pr.telegram;
  state.urgent = pr.urgent;
  state.freetext = pr.freetext;

  // Sync UI controls
  document.querySelectorAll('.device-buttons button').forEach(b => b.classList.remove('active'));
  document.getElementById('dev-' + state.device).classList.add('active');
  document.querySelectorAll('.screen-buttons button').forEach(b => b.classList.remove('active'));
  document.getElementById('scr-' + state.screen).classList.add('active');
  document.getElementById('tg-toggle').checked = state.telegram;
  document.getElementById('urgent-toggle').checked = state.urgent;
  document.getElementById('freetext-toggle').checked = state.freetext;

  setScreen(state.screen);
  updateAll();
}

// ══════ Question Navigation ══════
function selectAnswer(opt) {
  state.answers[state.currentQuestion] = opt;
  updateAnswerPills();
  updateDots();
  updatePrompt();

  // Visual feedback
  const pills = answerOptions.querySelectorAll('.answer-pill');
  pills.forEach(p => {
    if (p.dataset.opt === opt) {
      p.style.transform = 'scale(0.92)';
      setTimeout(() => { p.style.transform = ''; }, 150);
    }
  });
}

function prevQuestion() {
  if (state.currentQuestion > 1) {
    state.currentQuestion--;
    updateExam();
  }
}

function nextQuestion() {
  if (state.currentQuestion < state.totalQuestions) {
    state.currentQuestion++;
    updateExam();
  }
}

function jumpToQuestion(q) {
  state.currentQuestion = q;
  updateExam();
}

// Swipe support
let swipeStartX = 0;
let swiping = false;

answerBar.addEventListener('touchstart', (e) => {
  swipeStartX = e.touches[0].clientX;
  swiping = true;
}, { passive: true });

answerBar.addEventListener('touchmove', (e) => {
  // Handled on end
}, { passive: true });

answerBar.addEventListener('touchend', (e) => {
  if (!swiping) return;
  swiping = false;
  const diff = e.changedTouches[0].clientX - swipeStartX;
  if (Math.abs(diff) > 40) {
    if (diff < 0) nextQuestion();
    else prevQuestion();
  }
});

// Mouse swipe for desktop preview
let mouseStartX = 0;
let mouseDown = false;

answerBar.addEventListener('mousedown', (e) => {
  mouseStartX = e.clientX;
  mouseDown = true;
});

answerBar.addEventListener('mouseup', (e) => {
  if (!mouseDown) return;
  mouseDown = false;
  const diff = e.clientX - mouseStartX;
  if (Math.abs(diff) > 40) {
    if (diff < 0) nextQuestion();
    else prevQuestion();
  }
});

// ══════ Render ══════
function updateAll() {
  updateDevice();
  updateExam();
  updateResults();
  updateTelegram();
  updatePrompt();
}

function updateDevice() {
  const d = state.devices[state.device];
  const scale = Math.min(
    (window.innerHeight - 180) / (d.h + 24),
    (window.innerWidth - 360) / (d.w + 24),
    1
  );
  frame.style.width = (d.w + 24) + 'px';
  frame.style.height = (d.h + 24) + 'px';
  frame.style.transform = `scale(${scale})`;
  frame.style.transformOrigin = 'center center';

  // Notch
  if (d.notch === 'notch') {
    notchEl.className = 'notch';
    notchEl.style.display = 'block';
  } else if (d.notch === 'island') {
    notchEl.className = 'dynamic-island';
    notchEl.style.display = 'block';
  } else {
    notchEl.style.display = 'none';
  }
}

function updateExam() {
  const isFreetext = state.freetext || state.currentQuestion >= 36;
  qLabel.textContent = `Savol ${state.currentQuestion} / ${state.totalQuestions}`;
  qPrev.disabled = state.currentQuestion <= 1;
  qNext.disabled = state.currentQuestion >= state.totalQuestions;

  if (isFreetext) {
    answerOptions.style.display = 'none';
    answerTextContainer.style.display = 'block';
  } else {
    answerOptions.style.display = 'flex';
    answerTextContainer.style.display = 'none';
  }

  examTimer.textContent = state.urgent ? '00:02:15' : '01:23:45';
  examTimer.className = state.urgent ? 'exam-timer urgent' : 'exam-timer';

  updateAnswerPills();
  updateDots();
}

function updateAnswerPills() {
  const selected = state.answers[state.currentQuestion];
  answerOptions.querySelectorAll('.answer-pill').forEach(p => {
    p.classList.toggle('selected', p.dataset.opt === selected);
  });
}

function updateDots() {
  dots.innerHTML = '';
  for (let i = 1; i <= state.totalQuestions; i++) {
    const d = document.createElement('div');
    d.className = 'dot';
    if (state.answers[i]) d.classList.add('answered');
    if (i === state.currentQuestion) d.classList.add('current');
    d.addEventListener('click', () => jumpToQuestion(i));
    dots.appendChild(d);
  }
}

function updateResults() {
  const grid = document.getElementById('results-grid');
  grid.innerHTML = '';

  // Simulate some results
  const correctQs = [1,2,3,5,7,8,10,12,15,18,20,22,25,28,30,31,33,35,38,40,42,44,
                     4,6,9,11,13,14,16,19,21,23];
  const wrongQs = [17,24,26,27,29,32,34,36,37,39,41,43,45];

  for (let i = 1; i <= 45; i++) {
    const cell = document.createElement('div');
    cell.className = 'result-cell';
    if (correctQs.includes(i)) {
      cell.classList.add('correct');
      cell.innerHTML = `<span class="icon">&#10003;</span><span>${i}</span>`;
    } else if (wrongQs.includes(i)) {
      cell.classList.add('wrong');
      cell.innerHTML = `<span class="icon">&#10007;</span><span>${i}</span>`;
    } else {
      cell.classList.add('unanswered');
      cell.innerHTML = `<span class="icon">—</span><span>${i}</span>`;
    }
    grid.appendChild(cell);
  }
}

function updateTelegram() {
  const tg = state.telegram;

  // Telegram header bar
  tgHeaderBar.classList.toggle('visible', tg);
  if (tg) {
    const titles = { login: 'Math Exam', exam: 'Mock #3', results: 'Natijalar' };
    tgHeaderTitle.textContent = titles[state.screen] || 'Math Exam';
  }

  // Status bar - hide in TG mode (the TG header replaces it)
  statusBar.style.display = tg ? 'none' : 'flex';

  // Exam header
  if (state.screen === 'exam') {
    examHeader.style.display = tg ? 'none' : 'flex';
    // In TG mode, show a compact timer-only bar
    if (tg) {
      examHeader.style.display = 'flex';
      examHeader.className = 'exam-header telegram-header';
      examHeader.innerHTML = `
        <span></span>
        <span class="exam-timer ${state.urgent ? 'urgent' : ''}" id="exam-timer">${state.urgent ? '00:02:15' : '01:23:45'}</span>
        <span></span>
      `;
    } else {
      examHeader.className = 'exam-header';
      examHeader.innerHTML = `
        <button class="exam-back" onclick="goBack()">
          <svg width="10" height="16" viewBox="0 0 10 16" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round"><polyline points="8,2 2,8 8,14"/></svg>
        </button>
        <span class="exam-title">Matematika — Mock #3</span>
        <span class="exam-timer ${state.urgent ? 'urgent' : ''}" id="exam-timer">${state.urgent ? '00:02:15' : '01:23:45'}</span>
      `;
    }
  }

  // Results header
  if (state.screen === 'results') {
    resultsHeader.style.display = tg ? 'none' : 'flex';
  }

  // TG MainButton (only on exam screen)
  tgMainBtn.classList.toggle('visible', tg && state.screen === 'exam');

  // Answer bar bottom padding
  answerBar.classList.toggle('telegram-mode', tg);

  // Share button text
  if (tg) {
    shareBtnEl.innerHTML = `
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>
      Telegram'da ulashish
    `;
  } else {
    shareBtnEl.innerHTML = `
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
      Natijani ulashish
    `;
  }
}

function goBack() {
  const screenOrder = ['login', 'exam', 'results'];
  const idx = screenOrder.indexOf(state.screen);
  if (idx > 0) setScreen(screenOrder[idx - 1]);
}

// ══════ Prompt Output ══════
function updatePrompt() {
  const parts = [];
  const d = state.devices[state.device];

  parts.push(`Mobile UI for ${d.label} (${d.w}x${d.h})`);

  if (state.telegram) {
    parts.push('running as a Telegram Mini App');
    parts.push('using native Telegram MainButton for submit, BackButton for navigation, HapticFeedback on answer selection');
    parts.push(`header color set to ${getComputedStyle(document.documentElement).getPropertyValue('--primary').trim()}`);
  } else {
    parts.push('running in mobile browser');
    parts.push('custom header with back button, title, and timer');
  }

  if (state.screen === 'exam') {
    parts.push('showing exam page with full-screen PDF viewer (pinch-to-zoom, double-tap to fit)');
    parts.push('fixed bottom answer bar with question navigator');

    const answered = Object.keys(state.answers).length;
    parts.push(`${answered}/${state.totalQuestions} questions answered`);

    if (state.freetext || state.currentQuestion >= 36) {
      parts.push('free-text input mode with math keyboard support');
    } else {
      parts.push('MCQ mode with large A/B/C/D pill buttons (48px height, 14px border-radius)');
    }

    parts.push('swipe left/right to navigate questions, progress dots for quick jump');

    if (state.urgent) {
      parts.push('timer in URGENT mode (pulsing red, under 3 minutes remaining)');
    }
  } else if (state.screen === 'login') {
    parts.push('login page with 52px height inputs (16px font to prevent iOS zoom), 52px CTA button, full-width layout');
    if (state.telegram) {
      parts.push('NOTE: in Telegram mode this screen is skipped entirely — auto-auth via initData');
    }
  } else if (state.screen === 'results') {
    parts.push('results page with circular score indicator (32/45, 71%), color-coded question grid (green=correct, red=wrong, gray=unanswered)');
    if (state.telegram) {
      parts.push('share via Telegram using tg.shareMessage()');
    }
  }

  parts.push('touch targets minimum 44x44px, safe area insets respected, dynamic viewport height (dvh)');

  promptText.textContent = parts.join('. ') + '.';
}

// ══════ Copy ══════
function copyPrompt() {
  const btn = document.getElementById('copy-btn');
  navigator.clipboard.writeText(promptText.textContent).then(() => {
    btn.textContent = 'Copied!';
    btn.classList.add('copied');
    setTimeout(() => {
      btn.textContent = 'Copy';
      btn.classList.remove('copied');
    }, 1500);
  });
}

// ══════ Init ══════
updateAll();
window.addEventListener('resize', updateDevice);
</script>
</body>
</html>